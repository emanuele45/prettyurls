<?xml version="1.0"?>
<!DOCTYPE modification SYSTEM "http://www.simplemachines.org/xml/modification">

<modification xmlns="http://www.simplemachines.org/xml/modification" xmlns:smf="http://www.simplemachines.org/">
	<id>el:prettyurls-ext-none</id>
	<version>0.1</version>

	<file name="$boarddir/SSI.php">
		<operation>
			<search position="replace"><![CDATA[
		censorText($row['body']);

		// Build the array.
		$posts[] = array(
			'board' => array(
				'id' => $row['ID_BOARD'],
				'name' => $row['bName'],
				'href' => $scripturl . '?board=' . $row['ID_BOARD'] . '.0',
				'link' => '<a href="' . $scripturl . '?board=' . $row['ID_BOARD'] . '.0">' . $row['bName'] . '</a>'
]]></search>
			<add><![CDATA[
		censorText($row['body']);

		// Build the array.
		$pretty_board = $modSettings['pretty_root_url'] . '/' . (isset($context['pretty']['board_urls'][$row['ID_BOARD']]) ? $context['pretty']['board_urls'][$row['ID_BOARD']] : $row['ID_BOARD']) . '/0/';
		$posts[] = array(
			'board' => array(
				'id' => $row['ID_BOARD'],
				'name' => $row['bName'],
				'href' => $pretty_board,
				'link' => '<a href="' . $pretty_board . '">' . $row['bName'] . '</a>'
]]></add>
		</operation>

		<operation>
			<search position="replace"><![CDATA[
			$icon_sources[$row['icon']] = file_exists($settings['theme_dir'] . '/images/post/' . $row['icon'] . '.gif') ? 'images_url' : 'default_images_url';

		// Build the array.
		$posts[] = array(
			'board' => array(
				'id' => $row['ID_BOARD'],
				'name' => $row['bName'],
				'href' => $scripturl . '?board=' . $row['ID_BOARD'] . '.0',
				'link' => '<a href="' . $scripturl . '?board=' . $row['ID_BOARD'] . '.0">' . $row['bName'] . '</a>'
]]></search>
			<add><![CDATA[
			$icon_sources[$row['icon']] = file_exists($settings['theme_dir'] . '/images/post/' . $row['icon'] . '.gif') ? 'images_url' : 'default_images_url';

		// Build the array.
		$pretty_board = $modSettings['pretty_root_url'] . '/' . (isset($context['pretty']['board_urls'][$row['ID_BOARD']]) ? $context['pretty']['board_urls'][$row['ID_BOARD']] : $row['ID_BOARD']) . '/0/';
		$posts[] = array(
			'board' => array(
				'id' => $row['ID_BOARD'],
				'name' => $row['bName'],
				'href' => $pretty_board,
				'link' => '<a href="' . $pretty_board . '">' . $row['bName'] . '</a>'
]]></add>
		</operation>

		<operation>
			<search position="replace"><![CDATA[
	while ($row = mysql_fetch_assoc($request))
		$boards[] = array(
			'id' => $row['ID_BOARD'],
			'num_posts' => $row['numPosts'],
			'num_topics' => $row['numTopics'],
			'name' => $row['name'],
			'new' => empty($row['isRead']),
			'href' => $scripturl . '?board=' . $row['ID_BOARD'] . '.0',
			'link' => '<a href="' . $scripturl . '?board=' . $row['ID_BOARD'] . '.0">' . $row['name'] . '</a>'
		);
]]></search>
			<add><![CDATA[
	while ($row = mysql_fetch_assoc($request))
	{
		$pretty_board = $modSettings['pretty_root_url'] . '/' . (isset($context['pretty']['board_urls'][$row['ID_BOARD']]) ? $context['pretty']['board_urls'][$row['ID_BOARD']] : $row['ID_BOARD']) . '/0/';
		$boards[] = array(
			'id' => $row['ID_BOARD'],
			'num_posts' => $row['numPosts'],
			'num_topics' => $row['numTopics'],
			'name' => $row['name'],
			'new' => empty($row['isRead']),
			'href' => $pretty_board,
			'link' => '<a href="' . $pretty_board . '">' . $row['name'] . '</a>'
		);
	}
]]></add>
		</operation>
	</file>

	<file name="$sourcedir/BoardIndex.php">
		<operation>
			<search position="replace"><![CDATA[
function BoardIndex()
{
	global $txt, $scripturl, $db_prefix, $ID_MEMBER, $user_info, $sourcedir;
]]></search>
			<add><![CDATA[
function BoardIndex()
{
	global $txt, $scripturl, $db_prefix, $ID_MEMBER, $user_info, $sourcedir, $modSettings;
]]></add>
		</operation>

		<operation>
			<search position="replace"><![CDATA[
					'href' => $scripturl . '?board=' . $row_board['ID_BOARD'] . '.0',
					'link' => '<a href="' . $scripturl . '?board=' . $row_board['ID_BOARD'] . '.0">' . $row_board['boardName'] . '</a>'
				);
]]></search>
			<add><![CDATA[
					'href' => $modSettings['pretty_root_url'] . '/' . (isset($context['pretty']['board_urls'][$row_board['ID_BOARD']]) ? $context['pretty']['board_urls'][$row_board['ID_BOARD']] : $row_board['ID_BOARD']) . '/0/',
				);
				$this_category[$row_board['ID_BOARD']]['link'] = '<a href="' . $this_category[$row_board['ID_BOARD']]['href'] . '">' . $row_board['boardName'] . '</a>';
]]></add>
		</operation>

		<operation>
			<search position="replace"><![CDATA[
				'new' => empty($row_board['isRead']) && $row_board['posterName'] != '',
				'topics' => $row_board['numTopics'],
				'posts' => $row_board['numPosts'],
				'href' => $scripturl . '?board=' . $row_board['ID_BOARD'] . '.0',
				'link' => '<a href="' . $scripturl . '?board=' . $row_board['ID_BOARD'] . '.0">' . $row_board['boardName'] . '</a>'
			);
]]></search>
			<add><![CDATA[
				'new' => empty($row_board['isRead']) && $row_board['posterName'] != '',
				'topics' => $row_board['numTopics'],
				'posts' => $row_board['numPosts'],
				'href' => $modSettings['pretty_root_url'] . '/' . (isset($context['pretty']['board_urls']) ? $context['pretty']['board_urls'][$row_board['ID_BOARD']] : $row_board['ID_BOARD']) . '/0/',
			);
			$this_category[$row_board['ID_PARENT']]['children'][$row_board['ID_BOARD']]['link'] = '<a href="' . $this_category[$row_board['ID_PARENT']]['children'][$row_board['ID_BOARD']]['href'] . '">' . $row_board['boardName'] . '</a>';
]]></add>
		</operation>
	</file>

	<file name="$sourcedir/Load.php">
		<operation>
			<search position="replace"><![CDATA[
			array_reverse($board_info['parent_boards']),
			array(array(
				'url' => $scripturl . '?board=' . $board . '.0',
]]></search>
			<add><![CDATA[
			array_reverse($board_info['parent_boards']),
			array(array(
				'url' => $modSettings['pretty_root_url'] . '/' . (isset($context['pretty']['board_urls'][$board]) ? $context['pretty']['board_urls'][$board] : $board) . '/0/',
]]></add>
		</operation>

		<operation>
			<search position="replace"><![CDATA[
function getBoardParents($id_parent)
{
	global $db_prefix, $scripturl, $txt;
]]></search>
			<add><![CDATA[
function getBoardParents($id_parent)
{
	global $db_prefix, $scripturl, $txt, $modSettings, $context;
]]></add>
		</operation>

		<operation>
			<search position="replace"><![CDATA[
				$boards[$row['ID_BOARD']] = array(
					'url' => $scripturl . '?board=' . $row['ID_BOARD'] . '.0',
]]></search>
			<add><![CDATA[
				$boards[$row['ID_BOARD']] = array(
					'url' => $modSettings['pretty_root_url'] . '/' . (isset($context['pretty']['board_urls'][$row['ID_BOARD']]) ? $context['pretty']['board_urls'][$row['ID_BOARD']] : $row['ID_BOARD']) . '/0/',
]]></add>
		</operation>
	</file>

	<file name="$sourcedir/MessageIndex.php">
		<operation>
			<search position="replace"><![CDATA[
function MessageIndex()
{
	global $txt, $scripturl, $board, $db_prefix;
]]></search>
			<add><![CDATA[
function MessageIndex()
{
	global $txt, $scripturl, $board, $db_prefix, $modSettings;
]]></add>
		</operation>

		<operation>
			<search position="replace"><![CDATA[
	if (isset($_REQUEST['sort']))
		$context['page_index'] = constructPageIndex($scripturl . '?board=' . $board . '.%d;sort=' . $_REQUEST['sort'] . (isset($_REQUEST['desc']) ? ';desc' : ''), $_REQUEST['start'], $board_info['num_topics'], $maxindex, true);
	else
		$context['page_index'] = constructPageIndex($scripturl . '?board=' . $board . '.%d', $_REQUEST['start'], $board_info['num_topics'], $maxindex, true);
]]></search>
			<add><![CDATA[
	$pretty_board = $modSettings['pretty_root_url'] . '/' . (isset($context['pretty']['board_urls'][$board]) ? $context['pretty']['board_urls'][$board] : $board);
	if (isset($_REQUEST['sort']))
		$context['page_index'] = constructPageIndex($pretty_board . '/%d/?sort=' . $_REQUEST['sort'] . (isset($_REQUEST['desc']) ? ';desc' : ''), $_REQUEST['start'], $board_info['num_topics'], $maxindex, true);
	else
		$context['page_index'] = constructPageIndex($pretty_board . '/%d/', $_REQUEST['start'], $board_info['num_topics'], $maxindex, true);
]]></add>
		</operation>

		<operation>
			<search position="replace"><![CDATA[
					'href' => $scripturl . '?board=' . $row_board['ID_BOARD'] . '.0',
					'link' => '<a href="' . $scripturl . '?board=' . $row_board['ID_BOARD'] . '.0">' . $row_board['name'] . '</a>'
				);
]]></search>
			<add><![CDATA[
					'href' => $modSettings['pretty_root_url'] . '/' . (isset($context['pretty']['board_urls'][$row_board['ID_BOARD']]) ? $context['pretty']['board_urls'][$row_board['ID_BOARD']] : $row_board['ID_BOARD']) . '/0/',
				);
				$context['boards'][$row_board['ID_BOARD']]['link'] = '<a href="' . $context['boards'][$row_board['ID_BOARD']]['href'] . '">' . $row_board['name'] . '</a>';
]]></add>
		</operation>
		
		<operation>
			<search position="replace"><![CDATA[
				'href' => $scripturl . '?board=' . $row['ID_BOARD'] . '.0',
				'link' => '<a href="' . $scripturl . '?board=' . $row['ID_BOARD'] . '.0">' . $row['name'] . '</a>'
			);
]]></search>
			<add><![CDATA[
				'href' => $modSettings['pretty_root_url'] . '/' . (isset($context['pretty']['board_urls'][$row['ID_BOARD']]) ? $context['pretty']['board_urls'][$row['ID_BOARD']] : $row['ID_BOARD']) . '/0/',
			);
			$context['boards'][$row['ID_PARENT']]['children'][$row['ID_BOARD']]['link'] = '<a href="' . $context['boards'][$row['ID_PARENT']]['children'][$row['ID_BOARD']]['href'] . '">' . $row['name'] . '</a>';
]]></add>
		</operation>
	</file>

	<file name="$sourcedir/News.php">
		<operation>
			<search position="replace"><![CDATA[
				'topic' => $row['ID_TOPIC'],
				'board' => array(
					'name' => cdata_parse($row['bname']),
					'id' => $row['ID_BOARD'],
					'link' => $scripturl . '?board=' . $row['ID_BOARD'] . '.0'
]]></search>
			<add><![CDATA[
				'topic' => $row['ID_TOPIC'],
				'board' => array(
					'name' => cdata_parse($row['bname']),
					'id' => $row['ID_BOARD'],
					'link' => $modSettings['pretty_root_url'] . '/' . (isset($context['pretty']['board_urls'][$row['ID_BOARD']]) ? $context['pretty']['board_urls'][$row['ID_BOARD']] : $row['ID_BOARD']) . '/0/'
]]></add>
		</operation>

		<operation>
			<search position="replace"><![CDATA[
				),
				'board' => array(
					'name' => cdata_parse($row['bname']),
					'id' => $row['ID_BOARD'],
					'link' => $scripturl . '?board=' . $row['ID_BOARD'] . '.0'
]]></search>
			<add><![CDATA[
				),
				'board' => array(
					'name' => cdata_parse($row['bname']),
					'id' => $row['ID_BOARD'],
					'link' => $modSettings['pretty_root_url'] . '/' . (isset($context['pretty']['board_urls'][$row['ID_BOARD']]) ? $context['pretty']['board_urls'][$row['ID_BOARD']] : $row['ID_BOARD']) . '/0/'
]]></add>
		</operation>
	</file>

	<file name="$sourcedir/Recent.php">
		<operation>
			<search position="replace"><![CDATA[
function getLastPosts($showlatestcount)
{
	global $scripturl, $txt, $db_prefix, $user_info, $modSettings, $func;
]]></search>
			<add><![CDATA[
function getLastPosts($showlatestcount)
{
	global $scripturl, $txt, $db_prefix, $user_info, $modSettings, $func, $context;
]]></add>
		</operation>

		<operation>
			<search position="replace"><![CDATA[
		// Build the array.
		$posts[] = array(
			'board' => array(
				'id' => $row['ID_BOARD'],
				'name' => $row['bName'],
				'href' => $scripturl . '?board=' . $row['ID_BOARD'] . '.0',
				'link' => '<a href="' . $scripturl . '?board=' . $row['ID_BOARD'] . '.0">' . $row['bName'] . '</a>'
]]></search>
			<add><![CDATA[
		$pretty_board = $modSettings['pretty_root_url'] . '/' . (isset($context['pretty']['board_urls'][$row['ID_BOARD']]) ? $context['pretty']['board_urls'][$row['ID_BOARD']] : $row['ID_BOARD']) . '/0/';
		// Build the array.
		$posts[] = array(
			'board' => array(
				'id' => $row['ID_BOARD'],
				'name' => $row['bName'],
				'href' => $pretty_board,
				'link' => '<a href="' . $pretty_board . '">' . $row['bName'] . '</a>'
]]></add>
		</operation>

		<operation>
			<search position="replace"><![CDATA[
		$context['page_index'] = constructPageIndex($scripturl . '?action=recent;board=' . $board . '.%d', $_REQUEST['start'], min(100, $total_posts), 10, true);
]]></search>
			<add><![CDATA[
		$pretty_board = $modSettings['pretty_root_url'] . '/' . (isset($context['pretty']['board_urls'][$board]) ? $context['pretty']['board_urls'][$board] : $board);
		$context['page_index'] = constructPageIndex($pretty_board . '/%d/' . '?action=recent', $_REQUEST['start'], min(100, $total_posts), 10, true);
]]></add>
		</operation>

		<operation>
			<search position="replace"><![CDATA[
		// And build the array.
		$context['posts'][$row['ID_MSG']] = array(
]]></search>
			<add><![CDATA[
		// And build the array.
		$pretty_board = $modSettings['pretty_root_url'] . '/' . (isset($context['pretty']['board_urls'][$row['ID_BOARD']]) ? $context['pretty']['board_urls'][$row['ID_BOARD']] : $row['ID_BOARD']) . '/0/';
		$context['posts'][$row['ID_MSG']] = array(
]]></add>
		</operation>

		<operation>
			<search position="replace"><![CDATA[
				'href' => $scripturl . '?board=' . $row['ID_BOARD'] . '.0',
				'link' => '<a href="' . $scripturl . '?board=' . $row['ID_BOARD'] . '.0">' . $row['bname'] . '</a>'
			),
]]></search>
			<add><![CDATA[
				'href' => $pretty_board,
				'link' => '<a href="' . $pretty_board . '">' . $row['bname'] . '</a>'
			),
]]></add>
		</operation>

		<operation>
			<search position="replace"><![CDATA[
		// And build the array.
		$context['topics'][$row['ID_TOPIC']] = array(
]]></search>
			<add><![CDATA[
		// And build the array.
		$pretty_board = $modSettings['pretty_root_url'] . '/' . (isset($context['pretty']['board_urls'][$row['ID_BOARD']]) ? $context['pretty']['board_urls'][$row['ID_BOARD']] : $row['ID_BOARD']) . '/0/';
		$context['topics'][$row['ID_TOPIC']] = array(
]]></add>
		</operation>

		<operation>
			<search position="replace"><![CDATA[
				'href' => $scripturl . '?board=' . $row['ID_BOARD'] . '.0',
				'link' => '<a href="' . $scripturl . '?board=' . $row['ID_BOARD'] . '.0">' . $row['bname'] . '</a>'
			)
]]></search>
			<add><![CDATA[
				'href' => $pretty_board,
				'link' => '<a href="' . $pretty_board . '">' . $row['bname'] . '</a>'
			)
]]></add>
		</operation>
	</file>

</modification>
